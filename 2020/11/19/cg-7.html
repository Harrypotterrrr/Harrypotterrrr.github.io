<!DOCTYPE html><html lang="en">
  <head><!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176496785-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-176496785-1');
		
	</script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>The Notes of Computer Graphics Ⅶ - Haolin Jia's Homepage</title>

<meta name="description" content="Geometry, Implicit &amp; Explicit Geometry, Curve, Surface, Subdivision, Mesh Simplification">
<link rel="canonical" href="https://harrypotterrrr.github.io//2020/11/19/cg-7.html"><link rel="alternate" type="application/rss+xml" title="Haolin Jia's Homepage" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><script src="https://kit.fontawesome.com/0970362a03.js" crossorigin="anonymous"></script>
<!-- <link rel="stylesheet" href="https://kit.fontawesome.com/0970362a03.js" > --><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://kit.fontawesome.com/0970362a03.js',
        jquery: 'https://code.jquery.com/jquery-3.6.0.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.jss',
        gitalk: {
          js: '	https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.5.1/gitalk.min.js',
          css: 'https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.5.1/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h2,h3,h4'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page layout--page--sidebar clearfix js-page-root">
  <div class="page__mask d-print-none js-page-mask js-sidebar-hide"></div>
  <div class="page__viewport">
    <div class="page__actions d-print-none">
      <div class="button button--circle button--lg box-shadow-2 sidebar-button js-sidebar-show">
        <i class="fas fa-bars icon--show"></i>
      </div>
    </div>

    <div class="grid page__grid">

      <div class="page__sidebar d-print-none"><div class="sidebar-toc"><ul class="toc toc--navigator"><li class="toc-h1"><a href="/archive.html?tag=computer graphics">Computer Graphics</a></li><li class="toc-h2"><a href="/2020/08/10/cg-1">Overview</a></li><li class="toc-h2"><a href="/2020/08/11/cg-2">Linear Algebra</a></li><li class="toc-h2"><a href="/2020/08/15/cg-3">Transformation</a></li><li class="toc-h2"><a href="/2020/08/19/cg-4">Rasterization</a></li><li class="toc-h2"><a href="/2020/09/02/cg-5">Shading</a></li><li class="toc-h2"><a href="/2020/09/07/cg-6">Texture</a></li><li class="toc-h2 active"><a href="/2020/11/19/cg-7">Geometry</a></li><li class="toc-h2"><a href="/2020/11/25/cg-8">Ray Tracing</a></li><li class="toc-h2"><a href="/2020/12/03/cg-9">Advanced Ray Tracing</a></li><li class="toc-h2"><a href="/2020/12/20/cg-10">Material</a></li></ul></div></div><div class="page__main js-page-main has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="24px" height="24px" viewBox="0 0 24 24">
<style type="text/css">
	.st0{fill:#515151;}
</style>
<path class="st0" d="M1.7,22.3c5.7-5.7,11.3-5.7,17,0c3.3-3.3,3.5-5.3,0.8-6c2.7,0.7,3.5-1.1,2.3-5.6s-3.3-5.2-6.3-2.1
	c3-3,2.3-5.2-2.1-6.3S7,1.8,7.7,4.6C7,1.8,5,2.1,1.7,5.3C7.3,11,7.3,16.7,1.7,22.3"/>
</svg>
<a title="Keep working hard!
" href="/">Haolin Jia's Homepage</a></div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/blog">Blog</a></li><li class="navigation__item"><a href="/archive">Archive</a></li><li class="navigation__item"><a href="/about">About</a></li><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><div class="article__header"><header><h1>The Notes of Computer Graphics Ⅶ</h1></header><span class="split-space">&nbsp;</span>
          <a class="edit-on-github"
            title="Edit on Github"
            href="https://github.com/Harrypotterrrr/Harrypotterrrr.github.io/tree/master/_posts/2020/2020-11-19-cg-7.md">
            <i class="far fa-edit"></i></a></div><meta itemprop="headline" content="The Notes of Computer Graphics Ⅶ"><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=computer+graphics">computer graphics</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=notes">notes</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-eye"></i> <span class="js-pageview" data-page-key="blog-2020-11-19-cg-7">0</span> views</li><li><i class="far fa-calendar-alt"></i> <span>Dec 01, 2020</span>
            </li></ul></div><meta itemprop="author" content="Haolin Jia"/><meta itemprop="datePublished" content="2020-11-19T00:00:00-05:00">
    <meta itemprop="keywords" content="computer graphics,notes"><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody"><p>Geometry, Implicit &amp; Explicit Geometry, Curve, Surface, Subdivision, Mesh Simplification</p>

<!--more-->

<h2 id="geometry">Geometry</h2>

<ul>
  <li>Implicit Geometry
    <ul>
      <li>algebraic surface</li>
      <li>level sets</li>
      <li>distance functions</li>
      <li>…</li>
    </ul>
  </li>
  <li>Explicit Geometry
    <ul>
      <li>point cloud</li>
      <li>polygon mesh</li>
      <li>subdivision, NURBS</li>
      <li>…</li>
    </ul>
  </li>
  <li>Each choice best suited to a different task/type of geometry</li>
</ul>

<h3 id="implicit-representations-of-geometry">Implicit Representations of Geometry</h3>

<ul>
  <li>Based on classifying points: Points satisfy some specified relationship, without given coordinate
    <ul>
      <li>E.g. sphere: all points in 3D, where $x^2+y^2+z^2=1$</li>
      <li>More generally, $f(x, y, z) = 0$</li>
    </ul>
  </li>
</ul>

<p>Take $f(x, y, z)=\left(2-\sqrt{x^{2}+y^{2}}\right)^{2}+z^{2}-1$ as an example:</p>
<ul>
  <li>Implicit Surface sampling can be hard
    <ul>
      <li>What points lie on $f(x, y, z) = 0$</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJNoff.jpg" alt="cg-7-1" width="600px" /></p>

<p>Take $f(x, y, z)=x^{2}+y^{2}+z^{2}-1$ as an example:</p>
<ul>
  <li>Implicit Surface inside/outside test is easy
    <ul>
      <li>Is $(3/4, 1/2, 1/4)$ inside the sphere?</li>
      <li>Just plug it in $f(x, y, z) = -1/8 &lt; 0$, so Inside</li>
    </ul>
  </li>
</ul>

<h4 id="implicit-geometry">Implicit Geometry</h4>

<ul>
  <li>Implicit Algebraic Surfaces</li>
  <li>Constructive solid geometry</li>
  <li>Level set methods</li>
  <li>Fractals</li>
</ul>

<h4 id="algebraic-surfaces">Algebraic Surfaces</h4>

<ul>
  <li>Surface is zero set of a polynomial in x, y, z</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJNhTI.jpg" alt="cg-7-3" /></p>

<ul>
  <li>But how about using polynomial to represent a more complext object as a cow?</li>
</ul>

<h4 id="constructive-solid-geometry">Constructive Solid Geometry</h4>

<ul>
  <li><strong>Constructive Solid Geometry</strong> (<strong>CSG</strong>): Combine implicit geometry via Boolean operations</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJNf0A.jpg" alt="cg-7-4" width="700px" /></p>

<ul>
  <li>Use CSG and operation to define complex geometry</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJNWmd.png" alt="cg-7-5" width="400px" /></p>

<h4 id="distance-functions">Distance Functions</h4>

<ul>
  <li>
    <p><strong>Signed Distance Functions</strong> (<strong>SDF</strong>): determines the distance of a given point $x$ from the boundary of $\omega$. The function has positive values at points $x$ outside $\omega$, it decreases in value as $x$ approches the boundary of $\omega$ where the signed distance function is zero.</p>
  </li>
  <li>
    <p>Instead of Booleans, gradually blend surfaces together using Distance functions:</p>
    <ul>
      <li>Give minimum distance (could be signed distance) from anywhere to object</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJNItP.jpg" alt="cg-7-6" /></p>

<ul>
  <li>An Example: Blending (linear interp.) a moving boundary
    <ul>
      <li>The above row describes the normal blending of A and B region, which results A overlaps B</li>
      <li>The below row describes the blending using SDF, similar to superposition of the electric field of two same point charges, which results the zero plane right in the middle of A and B</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJNH1S.jpg" alt="cg-7-7" width="550px" /></p>

<ul>
  <li>
    <p>Blending any two distance functions: every point in the space can be represented as distance function, blending of two objects in the space is to sum up two distance functions. The boundary forms when the distance function is 0</p>
  </li>
  <li>
    <p>More details about <a href="https://www.youtube.com/watch?v=Cp5WWtMoeKg">distance function</a>, <a href="https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm">SDF code about various primitives</a> and <a href="https://www.iquilezles.org/www/index.htm">useful tutorial</a></p>
  </li>
</ul>

<h4 id="level-set-methods">Level Set Methods</h4>

<ul>
  <li>For Distance Function method, closed-form equations (解析式) are sometimes hard to describe complex shapes.</li>
  <li><strong>Level Set Methods</strong> performs numerical computations involving curves and surfaces on a fixed Cardesian grid without having to <strong>parameterize</strong> objects.
    <ul>
      <li>Level Set Methods is to store a grid of values approximating function.</li>
      <li>The central idea is same to SDF: find the boundary where the value is 0.</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJN7p8.jpg" alt="cg-7-8" /></p>

<ul>
  <li>Surface is found where interpolated values equal zero</li>
  <li>
    <p>Provides much more explicit control over shape (like a texture)</p>
  </li>
  <li>Level set encodes distance to air-liquid boundary to simulate physical scene of water dropping, constant tissue density to image medical data like CT, MRI etc.</li>
</ul>

<h4 id="fractal">Fractal</h4>

<ul>
  <li>Self-similarity, detail at all scales</li>
  <li>Hard to control shape</li>
  <li>Sometimes cause the drastic aliasing due to the high frequency of variation</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJNb6g.jpg" alt="cg-7-9" /></p>

<h4 id="pros--cons">Pros &amp; Cons</h4>

<ul>
  <li>Pros
    <ul>
      <li>compact description (a function), benefit for storing</li>
      <li>queries easy (inside object, distance to surface)</li>
      <li>good for ray-to-surface intersection</li>
      <li>easy to handle changes in topology (e.g. fluid)</li>
    </ul>
  </li>
  <li>Cons
    <ul>
      <li>difficult to model complex shapes</li>
    </ul>
  </li>
</ul>

<h3 id="explicit-representations-of-geometry">Explicit Representations of Geometry</h3>

<ul>
  <li>All points are given directly or via parameter mapping</li>
</ul>

\[f: \mathbb{R}^{2} \rightarrow \mathbb{R}^{3} ;(u, v) \mapsto(x, y, z)\]

<ul>
  <li>Given any $(u,v)$ coordinate, $(x, y, z)$ can be mapped</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJN5kt.jpg" alt="cg-7-2" width="600px" /></p>

<p>Take $f(u, v)=((2+\cos u) \cos v,(2+\cos u) \sin v, \sin u)$ as an example</p>
<ul>
  <li>Explicit Surface sampling is easy
    <ul>
      <li>What points lie on this surface: Just plug in $(u,v)$ values</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJNoff.jpg" alt="cg-7-1" width="600px" /></p>

<ul>
  <li>Take $f(u, v)=(\cos u \sin v, \sin u \sin v, \cos v)$ as an example
    <ul>
      <li>Is $(3/4, 1/2, 1/4)$ inside the sphere?</li>
    </ul>
  </li>
  <li>No Best Representation: depends on tasks</li>
</ul>

<h4 id="explicit-geometry">Explicit Geometry</h4>

<ul>
  <li>triangle meshes</li>
  <li>Bezier surfaces</li>
  <li>subdivision surfaces</li>
  <li>NURBS</li>
  <li>point clouds</li>
</ul>

<h4 id="polygon-mesh">Polygon Mesh</h4>

<ul>
  <li>Store vertices &amp; polygons (often triangles or quads)</li>
  <li>Easier to do processing / simulation, adaptive sampling</li>
  <li>More complicated data structures</li>
  <li>Perhaps most common representation in graphics</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJIepT.jpg" alt="cg-7-1" width="550px" /></p>

<ul>
  <li>The Wavefront Object File (.obj) Format
    <ul>
      <li>a text file that specifies vertices, normals, texture coordinates and their connectivities</li>
    </ul>
  </li>
</ul>

<h4 id="point-cloud">Point Cloud</h4>

<ul>
  <li>Easiest representation: list of points $(x, y, z)$</li>
  <li>Easily represent any kind of geometry</li>
  <li>Useful for large datasets (&gt;&gt; 1 point/pixel)</li>
  <li>Often converted into polygon mesh</li>
  <li>Difficult to draw in undersampled (采样不足的) regions</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJIm1U.gif" alt="cg-7-10" /></p>

<h2 id="curves">Curves</h2>

<h3 id="bézier-curve">Bézier Curve</h3>

<ul>
  <li>Defining Cubic Bézier Curve With Tangent</li>
  <li>Start point and the end point is $b_0$ and $b_2$</li>
  <li>Tangent of start and end is the tangent at $b_0$ and $b_2$</li>
</ul>

<p class="warning"><strong>Note</strong>: Bézier Curve is a representation of explicit geometry since it is way of <strong>parameter mapping</strong></p>

<p><img src="https://z3.ax1x.com/2021/01/12/sJIVhV.jpg" alt="cg-7-12" width="75%" /></p>

<h4 id="de-casteljau-algorithm">de Casteljau Algorithm</h4>

<ul>
  <li>Evaluate Bézier Curve
    <ul>
      <li>Consider three points (quadratic Bezier)</li>
      <li>Insert a point using linear interpolation</li>
      <li>Insert on both edges</li>
      <li>Repeat recursively until only one intermediate point exists</li>
      <li>Run the same algorithm for every $t$ in $[0, 1]$</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJIMnJ.gif" alt="cg-7-13" width="450px" /></p>

<h4 id="algebraic-formula">Algebraic Formula</h4>

<ul>
  <li>de Casteljau Algorithm gives a pyramid of coefficients</li>
</ul>

\[\begin{aligned} \mathbf{b}_{0}^{1}(t) &amp;=(1-t) \mathbf{b}_{0}+t \mathbf{b}_{1} \\ \mathbf{b}_{1}^{1}(t) &amp;=(1-t) \mathbf{b}_{1}+t \mathbf{b}_{2} \\ \mathbf{b}_{0}^{2}(t) &amp;=(1-t) \mathbf{b}_{0}^{1}+t \mathbf{b}_{1}^{1} \\ \mathbf{b}_{0}^{2}(t) &amp;=(1-t)^{2} \mathbf{b}_{0}+2 t(1-t) \mathbf{b}_{1}+t^{2} \mathbf{b}_{2} \end{aligned}\]

<p><img src="https://z3.ax1x.com/2021/01/12/sJIEt0.jpg" alt="cg-7-14" width="85%" /></p>

<ul>
  <li>General Algebraic Formula</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJIncF.jpg" alt="cg-7-15" /></p>

<ul>
  <li>Bernstein polynomials</li>
</ul>

\[B_{i}^{n}(t)=\left(\begin{array}{l}n \\ i\end{array}\right) t^{i}(1-t)^{n-i}\]

<ul>
  <li>For each $t$ moment, the sum of Bernstein Polynomials is 1. Drawing a vertical line at any $t$ moment, the sum of the y-coordinate of the intersection with the curve is 1.</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sJIuX4.jpg" alt="cg-7-16" width="350px" /></p>

<ul>
  <li>assume $n=3$ in $R^3$:</li>
</ul>

\[\mathbf{b}^{n}(t)=\mathbf{b}_{0}(1-t)^{3}+\mathbf{b}_{1} 3 t(1-t)^{2}+\mathbf{b}_{2} 3 t^{2}(1-t)+\mathbf{b}_{3} t^{3}\]

<ul>
  <li>The tangent of the curve in cubic case: the slope for Bézier Curve is the derivative with respect to $t$</li>
</ul>

\[\frac{d \mathbf{b}(t)}{d t}=\mathbf{b}^{\prime}(t)=3(1-t)^{2}\left(\mathbf{b}_{1}-\mathbf{b}_{0}\right)+6(1-t) t\left(\mathbf{b}_{2}-\mathbf{b}_{1}\right)+3 t^{2}\left(\mathbf{b}_{3}-\mathbf{b}_{2}\right)\]

<h4 id="properties-of-bézier-curve">Properties of Bézier Curve</h4>

<ul>
  <li>Interpolate endpoints: Start from $B_0$, end at $B_n$</li>
  <li>Tangent to end segment: In cubic case $\mathbf{b}^{\prime}(0)=3\left(\mathbf{b}_{1}-\mathbf{b}_{0}\right)$, $\mathbf{b}^{\prime}(1)=3\left(\mathbf{b}_{3}-\mathbf{b}_{2}\right)$</li>
  <li>Transform curve by transforming control points
    <ul>
      <li>Since the Bézier Curve is the result of linear combinations</li>
      <li>But it doesn’t work for <strong>projection transformation</strong></li>
    </ul>
  </li>
  <li>Convex hull (凸包) property
    <ul>
      <li>Curve is within convex hull of control points</li>
      <li>Convex hull is a concept in computational geometry. Briefly, it can be thought of as a rubber band that fits around all the points in 2D space</li>
    </ul>
  </li>
</ul>

<h4 id="piecewise-bézier-curve">Piecewise Bézier Curve</h4>

<ul>
  <li>Higher-order (high-degree 高阶) Bézier Curve is hard to control: Instead, Piecewise (逐段的) Bézier Curve is put forward
    <ul>
      <li>Chain many low-order Bézier Curves</li>
      <li>Piecewise cubic Bézier Curve is the most common technique and widely used in Apps (Illustrator, SVG, etc.)</li>
    </ul>
  </li>
  <li>For Cubic Curve, each four pair of point defining a piece of Bézier Curve
    <ul>
      <li>The curve is continuous when each piece of curve is connected</li>
      <li>The curve is smooth when the connection of each curve is smooth
        <ul>
          <li><strong>Smooth</strong>: the derivative (slope) of the previous ending point of the curve is the same as the subsequent curve. <code class="language-plaintext highlighter-rouge">Same</code> means both <strong>direction</strong> and <strong>the amount of value</strong>.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sYGH7q.jpg" alt="cg-7-17" width="450px" /></p>

<ul>
  <li>Continuity
    <ul>
      <li>$C^0$ continuity: $a_n = b_0$</li>
      <li>$C^1$ continuity: $a_n = b_0 = \frac{1}{2}(a_{n-1}+b_1)$</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sYGqA0.jpg" alt="cg-7-18" width="550px" /></p>

<ul>
  <li><a href="http://math.hws.edu/eck/cs424/notes2013/canvas/bezier.html">Animation of Bézier Curve</a></li>
</ul>

<h3 id="spline">Spline</h3>

<ul>
  <li><strong>Spline</strong> (样条): a continuous curve constructed so as to pass through a given set of points and have a certain number of continuous derivatives
    <ul>
      <li>In short, a curve under control directly</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sYG7Bn.jpg" alt="cg-7-19" width="450px" /></p>

<h3 id="b-splines">B-splines</h3>

<ul>
  <li><strong>B-spline</strong>: Short for basis splines</li>
  <li>Require more information than Bézier Curve curbes</li>
  <li>Satisfy all important properties that Bézier Curve have (i.e. superset)</li>
  <li><strong># TODO</strong>: refer to <a href="https://www.bilibili.com/video/
av66548502?from=search&amp;seid=65256805876131485">Shi-Min Hu’s course</a></li>
</ul>

<h3 id="nurbs">NURBS</h3>

<ul>
  <li><strong># TODO</strong>: refer to <a href="https://www.bilibili.com/video/
av66548502?from=search&amp;seid=65256805876131485">Shi-Min Hu’s course</a></li>
</ul>

<h2 id="surface">Surface</h2>

<h3 id="bézier-surface">Bézier Surface</h3>

<ul>
  <li>Extend Bézier curves to surfaces under control of 2D control points</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sYGv3F.gif" alt="cg-7-20" /></p>

<ul>
  <li>For Bicubic Bézier surface patch, evaluate surface position for parameters $(u, v)$
    <ul>
      <li>$(u, v)$ is parameters to describe two-dimensional $t$, which proves again that Bézier (parameter mapping) is explicit geometry representation</li>
      <li>Input: 4x4 control points</li>
      <li>Output: 2D surface parameterized by $(u, v)$ in $[0,1]^2$</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sYGTns.jpg" alt="cg-7-21" width="550px" /></p>

<ul>
  <li>Bicubic operation: similar to ‘Bicubic interpolation’</li>
  <li>Separable 1D de Casteljau Algorithm
    <ul>
      <li>Goal: evaluate surface position corresponding to $(u, v)$</li>
      <li>(u, v)-separable application of de Casteljau algorithm
        <ul>
          <li>Use de Casteljau to evaluate point $u$ on each of the 4 Bézier curves in $u$. This gives 4 control points for the ‘moving’ Bézier curve</li>
          <li>Use 1D de Casteljau to evaluate point $v$ on the ‘moving’ curve
<img src="https://z3.ax1x.com/2021/01/12/sYGLNV.jpg" alt="cg-7-22" width="600px" /></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sYGOhT.jpg" alt="cg-7-23" /></p>

<p class="info"><strong>TIP</strong>: piecewise (片段) in 2D curve vs patch (片) in 3D surface</p>

<ul>
  <li><strong>#TODO</strong>: Continuity</li>
</ul>

<h2 id="mesh-operations">Mesh Operations</h2>

<ul>
  <li>Mesh (网格) Operations: Geometry Processing
    <ul>
      <li>Mesh subdivion (细分): increase resolution (upsampling)</li>
      <li>Mesh simplification: decrease resolution (downsampling) while preserving shape/appearance</li>
      <li>Mesh regularization: modify sample distribution to improve quality</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/12/sYGj9U.jpg" alt="cg-7-24" /></p>

<h3 id="subdivision">Subdivision</h3>

<h4 id="loop-subdivision">Loop Subdivision</h4>

<ul>
  <li>Common subdivison rule for triangle meshes
    <ul>
      <li>First create more triangles (vertices)</li>
      <li>Second, tune their positions</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/15/swSW36.jpg" alt="cg-7-25" width="600px" /></p>

<ul>
  <li>Split each triangle into four</li>
  <li>Assign new vertex positions according to weights
    <ul>
      <li>New / old vertices updated differently</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/15/swSg41.jpg" alt="cg-7-26" width="700px" /></p>

<ul>
  <li>For new vertices: $ v = 3/8 * (A+B) + 1/8 * (C+D)$</li>
  <li>For old vertices:  \(\begin{aligned}v=(1-\beta) * original\_position + \beta * \sum^{n} neighbour\_position, \end{aligned} \\ where:\quad \beta=\left\{\begin{array}{l}\frac{3}{8 \mathrm{n}},\quad when\quad n&gt;3 \\ \frac{3}{16},\quad when\quad \mathrm{n}=3\end{array}\right.\)</li>
</ul>

<p class="info"><strong>Tip</strong>: $n$ is vertex degree. In graph theory, the degree of a vertex is the number of edges that are incident to the vertex.</p>

<p><img src="https://z3.ax1x.com/2021/01/15/swSR9x.jpg" alt="cg-7-27" width="700px" /></p>

<p class="warning"><strong>Note</strong>: Loop is family name of the founder Charles Loop of Loop Subdivision, so it has nothing to do with looping.</p>

<h4 id="catmul-clark-subdivision">Catmul-Clark Subdivision</h4>

<ul>
  <li>Catmul-Clark subdivision is more general than Loop Subdivision since Catmul-Clark Subdivision can handle mesh with not only triangles but quadrangles.</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/15/swSHUA.jpg" alt="cg-7-28" width="400px" /></p>

<ul>
  <li>Each subdivision step:
    <ul>
      <li>Keep all original vertex $d$</li>
      <li>Add vertex in each face $V_i$</li>
      <li>Add midpoint on each edge $E_i$</li>
      <li>Connect all new vertices</li>
    </ul>
  </li>
</ul>

\[\mathbf{V}_{i}=\frac{1}{n} \times \sum_{j=1}^{n} \mathbf{d}_{j}\]

\[\mathbf{E}_{i}=\frac{1}{4}\left(\mathbf{d}_{1}+\mathbf{d}_{2 i}+\mathbf{V}_{i}+\mathbf{V}_{i+1}\right)\]

\[\mathbf{d}_{i}^{\prime}=\frac{(n-3)}{n} \mathbf{d}_{i}+\frac{2}{n} \mathbf{R}+\frac{1}{n} \mathbf{S}\]

\[\mathbf{R}=\frac{1}{m} \sum_{i=1}^{m} \mathbf{E}_{i}, \mathbf{S}=\frac{1}{m} \sum_{i=1}^{m} \mathbf{V}_{i}\]

<ul>
  <li>After each subdivision
    <ul>
      <li>No extraordinatry (奇异点) vertices (degree != 4) left</li>
      <li>No non-quad face left</li>
    </ul>
  </li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/15/swS7Ed.jpg" alt="cg-7-29" width="750px" /></p>

<h3 id="mesh-simplification">Mesh Simplification</h3>

<ul>
  <li><strong>Goal</strong>: reduce number of mesh elements while maintaining the overall shape</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/15/swSfgK.jpg" alt="cg-7-30" width="750px" /></p>

<ul>
  <li><strong>Difficulty</strong>: For image simplification (downsampling), take Mipmap as an example, which can be performed by reducing the image resolution for several times, image pyramid (mip hierarchy) is used to represent different level of vision field. While for the geometry, it is difficult to use the similar pattern to divide the hierarchy of geometry, like how to make the number of geometric mesh change smoothly from far to near.</li>
</ul>

<h4 id="edge-collapsing">Edge Collapsing</h4>

<ul>
  <li>Suppose we simplify a mesh using edge collapsing</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/15/swShjO.jpg" alt="cg-7-31" width="550px" /></p>

<ul>
  <li>Geometric error will be introduced by simplification .</li>
  <li>Comparing to average and median simplification, error of quadric is minimum.</li>
</ul>

<p><img src="https://z3.ax1x.com/2021/01/15/swS5uD.jpg" alt="cg-7-32" width="700px" /></p>

<ul>
  <li>Quadric Error Metrics (二次误差度量)
    <ul>
      <li>Not a good idea to perform local averaging or median of vertices</li>
      <li><strong>Quadric error</strong>: new vertex should minimize its <strong>sum of square distance</strong> (<strong>L2 distance</strong>) to previously related triangle planes</li>
      <li>Idea: choose point that minimizes quadric error</li>
    </ul>
  </li>
  <li>Suppose squared distance of point $p$ to plane $q$</li>
</ul>

\[p=(x, y, z, 1)^{T}, q=(a, b, c, d)^{T}\]

\[d i s t(q, p)^{2}=\left(q^{T} p\right)^{2}=p^{T}\left(q q^{T}\right) p=: p^{T} Q_{q} p\]

\[where\quad Q_{q}=\left[\begin{array}{cccc}a^{2} &amp; a b &amp; a c &amp; a d \\ a b &amp; b^{2} &amp; b c &amp; b d \\ a c &amp; b c &amp; c^{2} &amp; c d \\ a d &amp; b d &amp; c d &amp; d^{2}\end{array}\right]\]

<p class="warning"><strong>Note</strong>: $q$ is a regularized parameter of plane, where $a^2+b^2+c^2 = 1$.</p>

<ul>
  <li>Sum distances to planes $q_i$ of vertex’ neighbouring triangles</li>
</ul>

\[\sum_{i} \operatorname{dist}\left(q_{i}, p\right)^{2}=\sum_{i} p^{T} Q_{q_{i}} p=p^{T}\left(\sum_{i} Q_{q_{i}}\right) p=: p^{T} Q_{p} p\]

<ul>
  <li>Point $p^{\star}$ that minimizes the error satisfies
    <ul>
      <li>Which turn into the optimization problem</li>
    </ul>
  </li>
</ul>

\[\left[\begin{array}{cccc}
q_{11} &amp; q_{12} &amp; q_{13} &amp; q_{14} \\
q_{21} &amp; q_{22} &amp; q_{23} &amp; q_{24} \\
q_{31} &amp; q_{32} &amp; q_{33} &amp; q_{34} \\
0 &amp; 0 &amp; 0 &amp; 1 \end{array}\right] \boldsymbol{p}^{*}=\left[\begin{array}{c} 0 \\ 0 \\ 0 \\ 1 \end{array}\right]\]

<ul>
  <li><strong>Simplification via Quadric Error</strong>: assign score with quadric error metric (<em>Garland &amp; Heckbert 1997</em>)
    <ul>
      <li>Approximate distance to surface as sum of distances to planes containing triangles</li>
      <li>Assign score with quadric error metric for <strong>each edge</strong> of the total geometric figure</li>
      <li>Sort the score of <strong>each edge</strong></li>
      <li>Select the smallest score with <strong>least</strong> quadric error metric and perform edge collapsing</li>
      <li>Update the corresponding changed edges with new quadric error</li>
      <li>Iteratively execute until the simplification reaches condition</li>
    </ul>
  </li>
</ul>

<p class="warning"><strong>Note</strong>: For each step, the edge corresponding to the least quadric error is selected to be collasped. Clearly, this is a way of reaching local optimum for each step to achieve global optimum, namely greedy strategy. However strictly speaking, this approch does not prove that the global optimal solution can be reached, but this insignificant error is allowed by default in CG.</p>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="https://sites.cs.ucsb.edu/~lingqi/teaching/games101.html">GAMES101, Lingqi Yan</a></li>
  <li><a href="https://www.youtube.com/watch?v=Cp5WWtMoeKg">ray marching and distance function</a></li>
  <li><a href="https://www.bilibili.com/read/cv7933990?from=search">光线步进和距离函数</a></li>
  <li><a href="[SPH算法](https://blog.csdn.net/liuyunduo/article/details/84098884)">SPH算法</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Smoothed-particle_hydrodynamics">Smoothed-particle hydrodynamics</a></li>
  <li><a href="http://acko.net/blog/making-mathbox/">Visualization of Bézier Surface</a></li>
</ul>
</div><section class="article__sharing d-print-none"></section><div class="d-print-none"><footer class="article__footer"><span><i class="fas fa-edit"></i> Create at
        <time itemprop="dateModified" datetime="2020-11-19T00:00:00-05:00">Dec 01, 2020</time>
    </span><!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div class="article__subscribe"><div class="subscribe"><i class="fas fa-rss"></i> <a type="application/rss+xml" href="/feed.xml">Subscribe</a></div>
</div><div class="article__license"><div class="license">
    <p>This work is licensed under a <a itemprop="license" rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">Attribution-NonCommercial 4.0 International</a> license.
      <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">
        <img alt="Attribution-NonCommercial 4.0 International" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" />
      </a>
    </p>
  </div></div></footer>
<div class="article__section-navigator clearfix"><div class="previous"><span>PREVIOUS</span><a href="/2020/12/20/cg-10">Material</a></div></div></div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div><section class="page__comments d-print-none"><!-- fix text color in the input textarea of gitalk -->
	<style type="text/css">
		.gitalk-wrapper .gt-header-textarea {
			color: #333 !important;
		}
	</style><div class="gitalk-wrapper" id="js-gitalk-container"></div><script>
		window.Lazyload.css('https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.5.1/gitalk.min.css');
		window.Lazyload.js('	https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.5.1/gitalk.min.js', function() {
			var gitalk = new Gitalk({
				clientID: '69b563d6a40e143550a4',
				clientSecret: '8c179732431d99e3ac53a0a113c6bfc09121530f',
				repo: 'Homepage',
				owner: 'Harrypotterrrr',
				admin: ['Harrypotterrrr'],
				id: 'blog-2020-11-19-cg-7'
			});
			gitalk.render('js-gitalk-container');
		});
	</script></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Haolin Jia"><meta itemprop="url" content="Harrypotterrrr.github.com"><meta itemprop="description" content="I am an amazing person."><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><link itemprop="url" href="Harrypotterrrr.github.com"><li title="Send me an Email.">
      <a class="button button--circle mail-button" itemprop="email" href="mailto:jiahaolin19971119@gmail.com" target="_blank">
        <i class="fas fa-envelope"></i>
      </a><li title="Follow me on Facebook.">
        <a class="button button--circle facebook-button" itemprop="sameAs" href="https://www.facebook.com/100012241788050" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M767.428571 6.857143l0 150.857143-89.714286 0q-49.142857 0-66.285714 20.571429t-17.142857 61.714286l0 108 167.428571 0-22.285714 169.142857-145.142857 0 0 433.714286-174.857143 0 0-433.714286-145.714286 0 0-169.142857 145.714286 0 0-124.571429q0-106.285714 59.428571-164.857143t158.285714-58.571429q84 0 130.285714 6.857143z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Twitter.">
        <a class="button button--circle twitter-button" itemprop="sameAs" href="https://twitter.com/Harrypotterrrr7" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M1024.032 194.432c-37.664 16.704-78.176 28-120.672 33.088 43.36-26.016 76.672-67.168 92.384-116.224-40.608 24.064-85.568 41.568-133.408 50.976-38.336-40.832-92.928-66.336-153.344-66.336-116.032 0-210.08 94.048-210.08 210.08 0 16.48 1.856 32.512 5.44 47.872-174.592-8.768-329.408-92.416-433.024-219.52-18.08 31.04-28.448 67.104-28.448 105.632 0 72.896 37.088 137.184 93.472 174.88-34.432-1.088-66.816-10.528-95.168-26.272-0.032 0.864-0.032 1.76-0.032 2.656 0 101.792 72.416 186.688 168.512 205.984-17.632 4.8-36.192 7.36-55.36 7.36-13.536 0-26.688-1.312-39.52-3.776 26.72 83.456 104.32 144.192 196.256 145.888-71.904 56.352-162.496 89.92-260.928 89.92-16.96 0-33.664-0.992-50.112-2.944 92.96 59.616 203.392 94.4 322.048 94.4 386.432 0 597.728-320.128 597.728-597.76 0-9.12-0.192-18.176-0.608-27.168 41.056-29.632 76.672-66.624 104.832-108.736z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Zhihu.">
        <a class="button button--circle zhihu-button" itemprop="sameAs" href="https://www.zhihu.com/people/jia-hao-lin-27" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z" p-id="907"></path><path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Linkedin.">
        <a class="button button--circle linkedin-button" itemprop="sameAs" href="https://www.linkedin.com/in/haolin-jia-7b4b49173/" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M260.096 155.648c0 27.307008-9.899008 50.516992-29.696 69.632-19.796992 19.115008-45.396992 28.672-76.8 28.672-30.036992 0-54.612992-9.556992-73.728-28.672-19.115008-19.115008-28.672-42.324992-28.672-69.632 0-28.672 9.556992-52.224 28.672-70.656 19.115008-18.432 44.372992-27.648 75.776-27.648 31.403008 0 56.32 9.216 74.752 27.648 18.432 18.432 28.331008 41.984 29.696 70.656 0 0 0 0 0 0m-202.752 808.96c0 0 0-632.832 0-632.832 0 0 196.608 0 196.608 0 0 0 0 632.832 0 632.832 0 0-196.608 0-196.608 0 0 0 0 0 0 0m313.344-430.08c0-58.708992-1.364992-126.292992-4.096-202.752 0 0 169.984 0 169.984 0 0 0 10.24 88.064 10.24 88.064 0 0 4.096 0 4.096 0 40.96-68.267008 105.812992-102.4 194.56-102.4 68.267008 0 123.220992 22.868992 164.864 68.608 41.643008 45.739008 62.464 113.664 62.464 203.776 0 0 0 374.784 0 374.784 0 0-196.608 0-196.608 0 0 0 0-350.208 0-350.208 0-91.476992-33.451008-137.216-100.352-137.216-47.787008 0-81.236992 24.576-100.352 73.728-4.096 8.192-6.144 24.576-6.144 49.152 0 0 0 364.544 0 364.544 0 0-198.656 0-198.656 0 0 0 0-430.08 0-430.08 0 0 0 0 0 0" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/Harrypotterrrr" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© Haolin Jia's Homepage 2020,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div></div></div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;

  window.Lazyload.js(SOURCES.jquery, function() {
    var $pageMask = $('.js-page-mask');
    var $pageRoot = $('.js-page-root');
    var $sidebarShow = $('.js-sidebar-show');
    var $sidebarHide = $('.js-sidebar-hide');

    function freeze(e) {
      if (e.target === $pageMask[0]) {
        e.preventDefault();
      }
    }
    function stopBodyScrolling(bool) {
      if (bool === true) {
        window.addEventListener('touchmove', freeze, { passive: false });
      } else {
        window.removeEventListener('touchmove', freeze, { passive: false });
      }
    }

    $sidebarShow.on('click', function() {
      stopBodyScrolling(true); $pageRoot.addClass('show-sidebar');
    });
    $sidebarHide.on('click', function() {
      stopBodyScrolling(false); $pageRoot.removeClass('show-sidebar');
    });
  });
})();
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script><script type="text/x-mathjax-config">
	var _config = {
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']]
        },
    };MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>(function() {
  function errorHandler(error, callback) {
    if (error) {
      callback && callback(error);
      throw error;
    }
  }

  function pageview(_AV, options) {
    var AV = _AV;
    var appId, appKey, appClass;
    appId = options.appId;
    appKey = options.appKey;
    appClass = options.appClass;
    AV.init({
      appId: appId,
      appKey: appKey
    });
    return {
      get: get,
      increase: increase
    };

    function searchKey(key) {
      var query = new AV.Query(appClass);
      query.equalTo('key', key);
      return query.first();
    }

    function insert(key, title) {
      var Blog = AV.Object.extend(appClass);
      var blog = new Blog();
      blog.set('title', title);
      blog.set('key', key);
      blog.set('views', 0);
      return blog.save();
    }

    function increment(result) {
      result.increment('views', 1);
      return result.save(null, {
        fetchWhenSave: true
      });
    }

    function get(key, callback) {
      searchKey(key).then(function(result) {
        if (result) {
          callback && callback(result.attributes.views);
        }
      }, errorHandler);
    }

    function increase(key, title, callback) {
      searchKey(key).then(function(result) {
        if (result) {
          increment(result).then(function(result) {
            callback && callback(result.attributes.views);
          });
        } else {
          insert(key, title).then(function(result) {
            increment(result).then(function(result) {
              callback && callback(result.attributes.views);
            });
          }, errorHandler);
        }
      }, errorHandler);
    }
  }
  window.pageview = pageview;
})();
</script>
  <script>
    window.Lazyload.js(['https://code.jquery.com/jquery-3.6.0.min.js', '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js'], function() {
      var pageview = window.pageview(AV, {
        appId:    'Q63N3hBVpAOkXqFX2IFRLou7-MdYXbMMI',
        appKey:   '4gLTYm8nQ482qrlMWfHqqxaS',
        appClass: 'Blog'
      });
      var key =   'blog-2020-11-19-cg-7';
      var title = "The Notes of Computer Graphics Ⅶ";
      pageview.increase(key, title, function(view) {
        $("[data-page-key='blog-2020-11-19-cg-7']").text(view);
      });
    });
  </script>
    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

